print(str_c(j," - ",length(onglets)))
library(readODS)
library(shiny)
library(ggplot2)
library(plotly)
library(stringr)
library(Hmisc)
library(xml2)
library(markdown)
library(shinythemes)
library(htmlwidgets)
library(httr)
library(ngramr)
library(dplyr)
library(htmltools)
library(shinyWidgets)
library(rclipboard)
library(lubridate)
library(leaflet)
library(shinyjs)
library(shinybusy)
library(chron)
library(data.table)
library(tidytext)
library(purrr)
library(rvest)
library(sf)
library(tidygeocoder)
library(leaflet.extras)
library(sp)
library(rgdal)
library(scales)
library(broom)
library(sensemakr)
library(tidyverse)
fichier="C:/Users/benjamin.azoulay/Documents/Historique Détection.ods"
fichier="C:/Users/benjamin.azoulay/Documents/Historique ENERGIE.ods"
onglets=list_ods_sheets(fichier)
df = data.frame(matrix(nrow = 6, ncol = length(onglets)))
colnames(df)=onglets
df$agent=c("ADN","LDU","MTS","HSE","NQE","PYS")
j=2
print(str_c(j," - ",length(onglets)))
a=read_ods(fichier,sheet = j)
View(a)
library(readODS)
library(shiny)
library(ggplot2)
library(plotly)
library(stringr)
library(Hmisc)
library(xml2)
library(markdown)
library(shinythemes)
library(htmlwidgets)
library(httr)
library(ngramr)
library(dplyr)
library(htmltools)
library(shinyWidgets)
library(rclipboard)
library(lubridate)
library(leaflet)
library(shinyjs)
library(shinybusy)
library(chron)
library(data.table)
library(tidytext)
library(purrr)
library(rvest)
library(sf)
library(tidygeocoder)
library(leaflet.extras)
library(sp)
library(rgdal)
library(scales)
library(broom)
library(sensemakr)
library(tidyverse)
fichier="C:/Users/benjamin.azoulay/Documents/Historique Détection.ods"
#fichier="C:/Users/benjamin.azoulay/Documents/Historique ENERGIE.ods"
onglets=list_ods_sheets(fichier)
df = data.frame(matrix(nrow = 6, ncol = length(onglets)))
colnames(df)=onglets
df$agent=c("ADN","LDU","MTS","HSE","NQE","PYS")
for (j in 1:length(onglets)) {
print(str_c(j," - ",length(onglets)))
a=read_ods(fichier,sheet = j)
while(str_detect(paste(a[1,],collapse = ""),"Trigramme")<1 & str_detect(paste(a[1,],collapse = ""),"TGM")<1 &
str_detect(paste(colnames(a),collapse = ""),"Trigramme")<1 & str_detect(paste(colnames(a),collapse = ""),"TGM")<1){a=a[-1,]}
if(str_detect(paste(colnames(a),collapse = ""),"Trigramme")<1 & str_detect(paste(colnames(a),collapse = ""),"TGM")<1){
colnames(a)=a[1,]
a=a[-1,]
}
colnames(a)[is.na(colnames(a))]=""
a=a[,str_detect(colnames(a),"Trigramme") | str_detect(colnames(a),"TGM") |  str_detect(colnames(a),"événement") | colnames(a)=="date" |str_detect(colnames(a),"ensemble") | str_detect(colnames(a),"Partie") | str_detect(colnames(a),"mmentaire")]
if(length(a)==3){colnames(a)=c("agent","date","commentaire")}
if(length(a)==4){colnames(a)=c("agent","date","materiel","commentaire")}
a$date=dmy(a$date)
a=a[a$date>=ymd("2023-01-01"),]
a=na.omit(a)
for (i in 1:length(df$agent)) {
df[i,j]=sum(str_count(a$agent,df$agent[i]))
}
}
View(a)
View(df)
View(a)
for (i in 1:length(df$agent)) {
df[i,j]=sum(str_count(a$agent,df$agent[i]))
}
View(df)
revues_persee = fromJSON("revues_persee.json")
library(jsonlite)
revues_persee = fromJSON("revues_persee.json")
setwd("C:/Users/benjamin.azoulay/docker_gallicagram/gallicagram")
revues_persee = fromJSON("revues_persee.json")
View(revues_persee)
revues_persee
revues_persee[1]
names(revues_persee)
shiny::runApp()
runApp()
?selectizeInput
runApp()
?pickerInput
runApp()
unique(unlist(revues_persee))
names(unique(unlist(revues_persee)))
unique(unlist(names(revues_persee)))
unique(names(unlist(revues_persee)))
unique(names((revues_persee)))
revues_persee[[]]
revues_persee[[1]]
unique(names(unlist(revues_persee)))
unique(names(unlist(revues_persee)))
str_extract(unique(names(unlist(revues_persee))),"\..+")
str_extract(unique(names(unlist(revues_persee))),"\\..+")
str_remove(str_extract(unique(names(unlist(revues_persee))),"\\..+"),\\.)
str_remove(str_extract(unique(names(unlist(revues_persee))),"\\..+"),"\\.")
runApp()
runApp()
runApp()
codes_revues=unique(str_remove(str_extract(unique(names(unlist(revues_persee[1]))),"\\..+"),"\\."))
runApp()
runApp()
runApp()
paste(c("a","b"),collapse = "+")
?glue
glue("{url_base}/query_persee?mot={URLencode(mot)}&from={from}&to={to}&revue=",paste(c("a","b"),collapse="+"))
library(glue)
glue("{url_base}/query_persee?mot={URLencode(mot)}&from={from}&to={to}&revue=",paste(c("a","b"),collapse="+"))
